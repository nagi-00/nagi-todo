
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğ : á´›á´á´…á´</title>
  <link rel="icon" href="./favi.ico" type="image/x-icon" />
  <style>
    @font-face { font-family: 'HJSS'; src: url('./HJSS.ttf') format('truetype'); }
    body { margin: 0; padding: 0; font-family: 'HJSS', sans-serif; background: #f5f5f5; box-sizing: border-box; }
    *, *::before, *::after { box-sizing: inherit; }
    button, input, textarea { font-family: inherit; }
    .sidebar-nav { text-align: center; padding: 1rem; }
    .sidebar-nav h2 { margin: 0; }
    .sidebar-controls { display: flex; justify-content: center; gap: 0.5rem; margin: 1rem 0; }
    .sidebar-controls button { background: #f0f0f0; border: none; padding: 0.5rem; border-radius: 0.25rem; cursor: pointer; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 0.25rem; text-align: center; margin-bottom: 1rem; }
    .main-container { max-width: 42rem; margin: 0 auto; background: #fff; border-radius: 0.5rem; padding: 1.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .note-display { padding: 0.5rem; background: #fafafa; border-radius: 0.25rem; margin-bottom: 1rem; cursor: pointer; }
    .note-input { width: 100%; border: 1px solid #ccc; padding: 0.5rem; border-radius: 0.25rem; resize: vertical; margin-bottom: 1rem; }
    .todo-input, .category-input { width: 100%; margin-bottom: 1rem; }
    .notes-list { display: flex; flex-direction: column; gap: 1rem; }
    .note-card { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 0.25rem; background: #fafafa; }
    .note-color { width: 1rem; height: 1rem; border-radius: 0.25rem; }
    .back-btn { margin-bottom: 1rem; background: #f0f0f0; border: none; padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script type="text/babel">
    // KST ê¸°ì¤€ í˜„ì¬ ì‹œê°„
    const getKST = () => {
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset() * 60000;
      return new Date(utc + 9 * 3600000);
    };

    // Firebase ì´ˆê¸°í™”
    const firebaseConfig = { /* ë„ˆì˜ ì„¤ì • */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function App() {
      // ìƒíƒœ
      const [selectedDate, setSelectedDate] = React.useState(getKST());
      const [todos, setTodos] = React.useState([]);
      const [note, setNote] = React.useState('');
      const [noteLocked, setNoteLocked] = React.useState(false);
      const [allNotes, setAllNotes] = React.useState({});
      const [dateColors, setDateColors] = React.useState({});
      const [text, setText] = React.useState('');
      const [category, setCategory] = React.useState('');
      const [view, setView] = React.useState('todo');
      const [editMode, setEditMode] = React.useState(false);

      const dateKey = selectedDate.toISOString().split('T')[0];
      const weekdays = ['S','M','T','W','T','F','S'];
      const weekdayColors = ['#C87171','#666','#666','#666','#666','#666','#7192C8'];

      // êµ¬ë…: todos
      React.useEffect(() => {
        const ref = db.ref(`todos/${dateKey}`);
        ref.on('value', snap => setTodos(snap.val()||[]));
        return () => ref.off();
      }, [dateKey]);

      // êµ¬ë…: ì˜¤ëŠ˜ ë…¸íŠ¸
      React.useEffect(() => {
        const ref = db.ref(`notes/${dateKey}`);
        ref.on('value', snap => {
          const v = snap.val()||'';
          setNote(v);
          setNoteLocked(!!v);
        });
        return () => ref.off();
      }, [dateKey]);

      // êµ¬ë…: ëª¨ë“  ë…¸íŠ¸
      React.useEffect(() => {
        const ref = db.ref('notes');
        ref.on('value', snap => setAllNotes(snap.val()||{}));
        return () => ref.off();
      }, []);

      // êµ¬ë…: ë‚ ì§œë³„ ì»¬ëŸ¬
      React.useEffect(() => {
        const ref = db.ref('dateColors');
        ref.on('value', snap => setDateColors(snap.val()||{}));
        return () => ref.off();
      }, []);

      // ë…¸íŠ¸ ì €ì¥/ê³ ì •
      const saveNote = v => db.ref(`notes/${dateKey}`).set(v);
      const lockNote = () => setNoteLocked(true);
      const unlockNote = () => setNoteLocked(false);

      // ì»¬ëŸ¬ ì €ì¥
      const saveColor = e => db.ref('dateColors').update({ [dateKey]: e.target.value });

      // í•  ì¼ ì¶”ê°€ ë“±
      const addTodo = () => {
        if (!text.trim()) return;
        db.ref(`todos/${dateKey}`).once('value').then(s => {
          const a = s.val()||[];
          a.push({ type:'todo', text: text.trim(), state:0 });
          db.ref(`todos/${dateKey}`).set(a);
          setText('');
        });
      };
      const addCat = () => {
        if (!category.trim()) return;
        db.ref(`todos/${dateKey}`).once('value').then(s => {
          const a = s.val()||[];
          a.push({ type:'category', text: category.trim() });
          db.ref(`todos/${dateKey}`).set(a);
          setCategory('');
        });
      };
      const addDiv = () =>
        db.ref(`todos/${dateKey}`).once('value').then(s => {
          const a = s.val()||[]; a.push({ type:'divider' });
          db.ref(`todos/${dateKey}`).set(a);
        });
      const toggle = i =>
        db.ref(`todos/${dateKey}`).once('value').then(s => {
          const a = s.val()||[];
          if (a[i].type==='todo') a[i].state = (a[i].state+1)%3;
          db.ref(`todos/${dateKey}`).set(a);
        });
      const remove = i =>
        db.ref(`todos/${dateKey}`).once('value').then(s => {
          const a = s.val()||[];
          a.splice(i,1);
          db.ref(`todos/${dateKey}`).set(a);
        });
      const edit = i =>
        db.ref(`todos/${dateKey}`).once('value').then(s => {
          const a = s.val()||[];
          const v = prompt('Edit:', a[i].text);
          if (v!=null && v.trim()) {
            a[i].text = v.trim();
            db.ref(`todos/${dateKey}`).set(a);
          }
        });

      // ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸°
      const exportImg = async () => {
        await document.fonts.ready;
        const c = document.getElementById('export-container');
        c.style.background = '#fff';
        const canvas = await html2canvas(c, { scale: window.devicePixelRatio, backgroundColor: '#fff' });
        canvas.toBlob(b => navigator.clipboard.write([new ClipboardItem({'image/png':b})]));
      };

      // ì˜¤ëŠ˜ë¡œ
      const goToday = () => { setSelectedDate(getKST()); setView('todo'); };

      // ë‹¬ë ¥ ê³„ì‚°
      const year = selectedDate.getFullYear(), m = selectedDate.getMonth();
      const days = new Date(year, m+1, 0).getDate();
      const start = new Date(year, m, 1).getDay();

      return (
        <div style={{ display:'flex', minHeight:'100vh' }}>
          {/* ì‚¬ì´ë“œë°” */}
          <div style={{ width:'16rem', background:'#fff', boxShadow:'0 2px 5px rgba(0,0,0,0.1)' }}>
            <div className="sidebar-nav">
              <h2>{year}<br/>{selectedDate.toLocaleString('en-US',{month:'long'})}</h2>
            </div>
            <div className="sidebar-controls">
              <button onClick={()=>setSelectedDate(d=>new Date(d.getFullYear(), d.getMonth()-1, 1))}>â†</button>
              <button onClick={goToday}>Today</button>
              <button onClick={()=>setSelectedDate(d=>new Date(d.getFullYear(), d.getMonth()+1, 1))}>â†’</button>
            </div>
            <div className="calendar-grid">
              {weekdays.map((d,i)=><div key={i} style={{ color:weekdayColors[i], fontWeight:500 }}>{d}</div>)}
              {Array(start).fill().map((_,i)=><div key={i}/>)}
              {Array(days).fill().map((_,i)=>{
                const dt=new Date(year,m,i+1);
                const k=dt.toISOString().split('T')[0];
                const sel = k===dateKey;
                return (
                  <button key={i}
                    onClick={()=>setSelectedDate(dt)}
                    style={{
                      width:24, height:24, margin:'auto',
                      border:'none', borderRadius:'50%',
                      background: sel?(dateColors[k]||'#888'):'transparent',
                      color: sel?'#fff':'#000', cursor:'pointer'
                    }}>
                    {i+1}
                  </button>
                );
              })}
            </div>
            <button className="sidebar-controls" onClick={()=>setView('notes')}>Notes</button>
          </div>

          {/* ë©”ì¸ */}
          <div style={{ flex:1, padding:'1rem', background:'#f5f5f5' }}>
            {view==='todo' ? (
              <div id="export-container" className="main-container">
                <h2 style={{ marginBottom:16 }}>
                  {selectedDate.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}
                </h2>

                {/* ì˜¤ëŠ˜ì˜ í•œë§ˆë”” */}
                {noteLocked ? (
                  <div className="note-display" onDoubleClick={unlockNote}>{note}</div>
                ) : (
                  <textarea className="note-input"
                    value={note}
                    onChange={e=>setNote(e.target.value)}
                    onKeyDown={e=>{
                      if(e.key==='Enter'&&!e.shiftKey){
                        e.preventDefault();
                        saveNote(note);
                        lockNote();
                      }
                    }}
                    placeholder="ì˜¤ëŠ˜ì˜ í•œë§ˆë””... (Enter ê³ ì •, Shift+Enter ì¤„ë°”ê¿ˆ)"
                    rows={2}
                  />
                )}

                {/* ìƒ‰ìƒ ì„ íƒ */}
                <div style={{ display:'flex', alignItems:'center', gap:8, marginBottom:16 }}>
                  <span>This dateâ€™s color:</span>
                  <input type="color" value={dateColors[dateKey]||'#888'} onChange={saveColor}/>
                </div>

                {/* í•  ì¼ ì…ë ¥ */}
                <textarea className="todo-input"
                  value={text}
                  onChange={e=>setText(e.target.value)}
                  onKeyDown={e=>{ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); addTodo(); } }}
                  placeholder="í•  ì¼ ì¶”ê°€ (Enter ì €ì¥, Shift+Enter ì¤„ë°”ê¿ˆ)"
                  rows={3}
                />

                <div style={{ display:'flex', gap:8, marginBottom:16 }}>
                  <button onClick={addDiv}>Add Divider</button>
                  <input className="category-input"
                    value={category}
                    onChange={e=>setCategory(e.target.value)}
                    onKeyDown={e=>{ if(e.key==='Enter'){ addCat(); } }}
                    placeholder="ì¹´í…Œê³ ë¦¬ ì¶”ê°€..."
                  />
                </div>

                {/* ë¦¬ìŠ¤íŠ¸ */}
                <div style={{ display:'flex', flexDirection:'column', gap:8 }}>
                  {todos.map((it,i)=>(
                    it.type==='divider' ? <hr key={i}/> :
                    it.type==='category' ? <div key={i} style={{ fontWeight:600 }}>{it.text}</div> : (
                      <div key={i}
                        onClick={()=>!editMode&&toggle(i)}
                        style={{
                          display:'flex', alignItems:'center', gap:8,
                          padding:8, background:'#fff', borderRadius:4,
                          cursor: editMode?'default':'pointer'
                        }}>
                        <span style={{ fontFamily:'monospace' }}>{['â˜','â˜‘','â˜’'][it.state]}</span>
                        <span style={{ flex:1 }}>{it.text}</span>
                        {editMode && <>
                          <button className="edit-delete-btn" onClick={()=>edit(i)}>Edit</button>
                          <button className="edit-delete-btn" onClick={()=>remove(i)}>Del</button>
                        </>}
                      </div>
                    )
                  ))}
                </div>

                {/* í•˜ë‹¨ ë²„íŠ¼ */}
                <div style={{ display:'flex', gap:8, marginTop:16 }}>
                  <button onClick={exportImg}>Export as Image</button>
                  <button onClick={()=>setEditMode(m=>!m)}>
                    {editMode?'Done':'Edit'}
                  </button>
                </div>
              </div>
            ) : (
              <div className="main-container">
                <button className="back-btn" onClick={()=>setView('todo')}>Back</button>
                <div className="notes-list">
                  {Object.entries(allNotes).sort((a,b)=>b[0].localeCompare(a[0])).map(([k,v])=>{
                    const d=new Date(k);
                    return (
                      <div key={k} className="note-card">
                        <div className="note-color" style={{ background: dateColors[k]||'#888' }}/>
                        <div><strong>{d.toLocaleDateString('en-US',{year:'numeric',month:'numeric',day:'numeric',weekday:'short'})}</strong></div>
                        <div>{v}</div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
```
