<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>𝐝 : ᴛᴏᴅᴏ</title>
  <link rel="icon" href="./favi.ico" type="image/x-icon" />
  <style>
    @font-face { font-family:'HJSS'; src:url('./HJSS.ttf') format('truetype'); }
    body { margin:0; padding:0; font-family:'HJSS',sans-serif; background:#f5f5f5; box-sizing:border-box; }
    *,*::before,*::after { box-sizing:inherit; }
    .edit-delete-btn { font-size:.75rem; color:#888; background:none; border:none; cursor:pointer; margin-left:.5rem; }
    .drag-handle    { cursor:grab; font-size:1rem; margin-right:.5rem; color:#aaa; }
    .completed      { color:#aaa; }
    .no-export      { /* html2canvas ignoreElements로만 숨김 */ }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script type="text/babel">
// Firebase 초기화
const firebaseConfig = {
  apiKey: "AIzaSyAa-8IWlzzPflkV6Iqzunha5TCnMXclTns",
  authDomain: "nagi-todo.firebaseapp.com",
  databaseURL: "https://nagi-todo-default-rtdb.firebaseio.com",
  projectId: "nagi-todo",
  storageBucket: "nagi-todo.appspot.com",
  messagingSenderId: "923414063910",
  appId: "1:923414063910:web:e09c59bc3cc72a19686fe7"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// App, 할 일 로직들 생략 (이전 응답에 모두 반영됨)

// DiscordBotWidget 컴포넌트 - 집중 시간에만 GitHub JSON에서 메시지 불러오기
function DiscordBotWidget() {
  const [isVisible, setIsVisible] = React.useState(false);
  const [lastMessage, setLastMessage] = React.useState('');
  const [isOnline, setIsOnline] = React.useState(false);

  const isFocusTime = () => {
    const now = new Date();
    const kst = new Date(now.getTime() + 9 * 60 * 60 * 1000);
    const day = kst.getDay();
    const hour = kst.getHours();
    const focusRanges = {
      1: [9, 13],
      2: [9, 18],
      3: [9, 13],
      4: [9, 18],
      5: [9, 21],
    };
    const range = focusRanges[day];
    return range && hour >= range[0] && hour < range[1];
  };

  React.useEffect(() => {
    const updateStatus = async () => {
      const online = isFocusTime();
      setIsOnline(online);
      if (online) {
        try {
          const res = await fetch("https://raw.githubusercontent.com/nagi-00/nagi-todo/main/demian_focus_messages.json");
          const data = await res.json();
          const random = data.messages[Math.floor(Math.random() * data.messages.length)];
          setLastMessage(random);
        } catch {
          setLastMessage("메시지를 불러오지 못했어.");
        }
      }
    };
    updateStatus();
    const timer = setInterval(updateStatus, 60000);
    return () => clearInterval(timer);
  }, []);
  return (
    <>
      <div onClick={() => setIsVisible(!isVisible)} style={{
        position: 'fixed', bottom: '20px', right: '20px', width: '60px', height: '60px',
        borderRadius: '50%', background: isOnline ? '#667eea' : '#ccc', display: 'flex',
        alignItems: 'center', justifyContent: 'center', cursor: 'pointer', zIndex: 1000
      }}>
        <span style={{ fontSize: '24px', color: '#fff' }}>🖤</span>
      </div>
      {isVisible && (
        <div style={{
          position: 'fixed', bottom: '100px', right: '20px', width: '300px',
          background: '#fff', borderRadius: '15px', padding: '20px',
          boxShadow: '0 8px 25px rgba(0,0,0,0.15)', zIndex: 999
        }}>
          {isOnline ? (
            <>
              <div style={{ fontWeight: 'bold', fontSize: '15px', marginBottom: '0.5rem' }}>ᴅᴇᴍɪᴀɴ</div>
              <div style={{ fontSize: '14px', color: '#333' }}>{lastMessage}</div>
            </>
          ) : (
            <>
              <div style={{ textAlign: 'center', color: '#888', fontSize: '14px' }}>
                😴 휴식의 시간이야.
              </div>
              <div style={{ fontSize: '12px', marginTop: '8px', textAlign: 'center' }}>
                집중시간<br/>
                월 (9-13시)<br/>
                화 (9-18시)<br/>
                수 (9-13시)<br/>
                목 (9-18시)<br/>
                금 (9-21시)<br/>
              </div>
            </>
          )}
        </div>
      )}
    </>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
